<!DOCTYPE html>
<html lang="en">
	<head>
    	<meta charset="utf-8">
    	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	    <meta name="viewport" content="width=device-width, initial-scale=1">
	    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
	    {% if hostname %}
	    	<title>{{ hostname }} - server HUD</title>
	    {% else %}
	        <title>Unknown hostname - server HUD</title>
	    {% endif %}
	    <link href="/static/css/dashboard.css" rel="stylesheet">
  	</head>
	<body>
		<div class="header"><div class="text-center" id="clock">server-hud - {{ hostname }} - 00:00</div></div>
		<div class="web-panel">
			<div class="panel-heading"><div class="text-center">Web server stats</div></div>
			<div class="connections col-2">
	 			<div class="panel-heading">Active connections</div>
				<div class="panel-body"><h1 class="text-center high" id="connections">0</h1></div>
			</div>
			<div class="url col-4">
				<div class="panel-heading">Latest remote address</div>
				<div class="panel-body"><h3 class="text-center" id="remote">0.0.0.0</h3></div>
			</div>
			<div class="uptime col-2">
				<div class="panel-heading">Uptime</div>
				<div class="panel-body"><h3 class="text-center" id="uptime">00:00</h3></div>
			</div>
			<div class="accesses col-2">
				<div class="panel-heading">Logged accesses</div>
				<div class="panel-body"><h3 class="text-center" id="accesses">0</h3></div>
			</div>
		</div>
		<div class="speed-panel">
			<div class="panel-heading"><div class="text-center">Firewall stats</div></div>
			<div class="connections col-2">
	 			<div class="panel-heading">Active connections</div>
				<div class="panel-body"><h1 class="text-center high" id="fw_connections">0</h1></div>
			</div>
			<div class="speed col-4">
				<div class="panel-heading">Receive speed</div>
				<div class="panel-body"><h3 class="text-center" id="rcv_speed">0.00 KiB/s</h3></div>
			</div>
			<div class="speed col-4">
				<div class="panel-heading">Send speed</div>
				<div class="panel-body"><h3 class="text-center" id="send_speed">0.00 KiB/s</h3></div>
			</div>
		</div>
		<div class="footer">
			<div class="text-center">
				server-hud Copyright &copy; 20015-2016 Martin Bo Kristensen Gr&oslash;nholdt. Uses
				<a href="https://github.com/toddmotto/atomic">atomic</a>,
				<a href="http://flask.pocoo.org/">flask</a>,
				<a href="https://github.com/joewalnes/reconnecting-websocket">reconnecting-websocket</a>, and
				<a href="http://www.tornadoweb.org/en/stable/#">Tornado</a>
			</div>
		</div>
		<script src="static/js/atomic.js" type="text/javascript"></script>
		<script src="static/js/reconnecting-websocket.min.js" type="text/javascript"></script>
		<script type="text/javascript">
var last_connections = 0;
var ws_conn = new ReconnectingWebSocket('{{ config['HOSTS']['web_connections'] }}/ws/connections');
var ws_accesses = new ReconnectingWebSocket('{{ config['HOSTS']['web_accesses'] }}/ws/accesses');
var ws_host = new ReconnectingWebSocket('{{ config['HOSTS']['web_remote_host'] }}/ws/remote_host');
var ws_uptime = new ReconnectingWebSocket('{{ config['HOSTS']['web_uptime'] }}/ws/uptime');
var ws_fw_conn = new ReconnectingWebSocket('{{ config['HOSTS']['fw_connections'] }}/ws/connections');
var ws_fw_speed = new ReconnectingWebSocket('{{ config['HOSTS']['fw_speed'] }}/ws/speed');

var connections = document.getElementById("connections");
var remote = document.getElementById("remote");
var uptime = document.getElementById("uptime");
var accesses = document.getElementById("accesses");
var fw_conn = document.getElementById("fw_connections");
var fw_rcv_speed = document.getElementById("rcv_speed");
var fw_send_speed = document.getElementById("send_speed");

function updateTime()
{
	var today=new Date();
	var h=today.getHours();
	var m=today.getMinutes();
	if (m < 10)
	{
		m = "0" + m
	}
	document.getElementById('clock').innerHTML = "server-hud - {{ hostname }} - " + h + ":" + m;
}

function updateMinute()
{
	updateTime();
}

updateMinute();
setInterval(updateMinute, 60000);

// Process connections messages
ws_conn.onopen = function(event)
{
	ws_conn.send("");
};

ws_conn.onmessage = function(event)
{
	json_data = JSON.parse(event.data)
	connections.innerHTML = json_data.connections;
};

//Process access messages
ws_accesses.onopen = function(event)
{
	ws_accesses.send("");
};

ws_accesses.onmessage = function(event)
{
	json_data = JSON.parse(event.data)
	accesses.innerHTML = json_data.accesses;
};

//Process remote host messages
ws_host.onopen = function(event)
{
	ws_host.send("");
};

ws_host.onmessage = function(event)
{
	json_data = JSON.parse(event.data)
	remote.innerHTML = json_data.remote_host;
};

//Process uptime messages
ws_uptime.onopen = function(event)
{
	ws_uptime.send("");
};

ws_uptime.onmessage = function(event)
{
	json_data = JSON.parse(event.data)
	uptime.innerHTML = json_data.uptime;
};

//Process firewall connections messages
ws_fw_conn.onopen = function(event)
{
	ws_fw_conn.send("");
};

ws_fw_conn.onmessage = function(event)
{
	json_data = JSON.parse(event.data)
	fw_conn.innerHTML = json_data.connections;
};

//Process firewall speed messages
ws_fw_speed.onopen = function(event)
{
	ws_accesses.send("");
};

ws_fw_speed.onmessage = function(event)
{
	json_data = JSON.parse(event.data)
	fw_rcv_speed.innerHTML = json_data.receive;
	fw_send_speed.innerHTML = json_data.send;
};
		</script>
	</body>
</html>